{{ define "main" }}
<article class="post-entry">
    <h1 class="post-title">{{ .Title }}</h1>
    <div class="post-meta">
        <span>üìÖ ƒêƒÉng ng√†y: {{ .Date.Format "02/01/2006" }}</span>
    </div>
    
    <hr style="border:0; border-top:1px solid #eee; margin:20px 0;">

    <div id="reader-controls">
        <select id="voice-select" class="reader-select">
            <option value="female">üë© Gi·ªçng N·ªØ</option>
            <option value="male">üë® Gi·ªçng Nam</option>
        </select>
        <select id="rate-select" class="reader-select">
            <option value="1">üë§ V·ª´a</option>
            <option value="1.2">üêá Nhanh</option>
            <option value="0.8">üê¢ Ch·∫≠m</option>
        </select>
        <button id="speak-btn" class="reader-btn">üîä ƒê·ªçc ngay</button>
        <button id="stop-btn" class="reader-btn">‚èπÔ∏è D·ª´ng</button>
        <div id="reader-status" class="reader-status">S·∫µn s√†ng</div>
    </div>

    <button id="copy-btn" class="copy-rich-btn">
        <svg class="copy-icon" viewBox="0 0 24 24"><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1c-1.3 0-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zm2 14H7v-2h7v2zm3-4H7v-2h10v2zm0-4H7V7h10v2z"/></svg>
        <span>Copy b√†i vi·∫øt</span>
    </button>

    <div class="post-body" id="post-content">
        {{ .Content }}
    </div>
</article>

<script>
document.addEventListener('DOMContentLoaded', function() {
    const contentDiv = document.getElementById('post-content');
    
    // --- 1. X·ª¨ L√ù COPY ---
    document.getElementById('copy-btn').addEventListener('click', function() {
        const btn = this;
        const originalHtml = btn.innerHTML;
        
        // T·∫°o v√πng t·∫°m ƒë·ªÉ copy (gi·ªØ ƒë·ªãnh d·∫°ng HTML)
        const tempDiv = document.createElement('div');
        tempDiv.innerHTML = `<h1>{{ .Title }}</h1>` + contentDiv.innerHTML;
        tempDiv.style.position = 'fixed'; 
        tempDiv.style.left = '-9999px';
        document.body.appendChild(tempDiv);
        
        const selection = window.getSelection();
        const range = document.createRange();
        range.selectNodeContents(tempDiv);
        selection.removeAllRanges();
        selection.addRange(range);
        
        try {
            document.execCommand('copy');
            btn.classList.add('copied');
            btn.innerHTML = '<span>ƒê√£ xong!</span>';
            setTimeout(() => {
                btn.classList.remove('copied');
                btn.innerHTML = originalHtml;
            }, 2000);
        } catch(e) { alert('L·ªói copy'); }
        
        document.body.removeChild(tempDiv);
    });

    // --- 2. X·ª¨ L√ù ƒê·ªåC VƒÇN B·∫¢N (Text-to-Speech) ---
    const speakBtn = document.getElementById('speak-btn');
    const stopBtn = document.getElementById('stop-btn');
    const rateSelect = document.getElementById('rate-select');
    const voiceSelect = document.getElementById('voice-select');
    const statusTxt = document.getElementById('reader-status');

    if (typeof responsiveVoice !== 'undefined') {
        speakBtn.addEventListener('click', function() {
            let text = contentDiv.innerText;
            // L√†m s·∫°ch vƒÉn b·∫£n gi·ªëng trong Blogger XML
            text = text.replace(/https?:\/\/[^\s]+/g, ' ')
                       .replace(/[:;\-\‚Äì\_]/g, ", ")
                       .replace(/[\"\'\(\)\[\]\{\}\<\>]/g, " ")
                       .replace(/[\r\n]+/g, ".")
                       .replace(/\.{2,}/g, ".");

            const rate = parseFloat(rateSelect.value);
            const pitch = voiceSelect.value === 'male' ? 0.8 : 1;

            speakBtn.style.display = 'none';
            stopBtn.style.display = 'flex';
            statusTxt.innerText = 'ƒêang ƒë·ªçc...';

            responsiveVoice.speak(text, "Vietnamese Female", {
                rate: rate, 
                pitch: pitch,
                onend: resetReader,
                onerror: resetReader
            });
        });

        stopBtn.addEventListener('click', function() {
            responsiveVoice.cancel();
            resetReader();
        });

        function resetReader() {
            speakBtn.style.display = 'flex';
            stopBtn.style.display = 'none';
            statusTxt.innerText = 'S·∫µn s√†ng';
        }
    } else {
        statusTxt.innerText = 'L·ªói t·∫£i gi·ªçng ƒë·ªçc';
    }
});
</script>
{{ end }}